define("local_overflow/reviewing",["exports","core/ajax","core/prefetch","core/templates","core/str"],(function(_exports,_ajax,_prefetch,_templates,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Implements reviewing functionality
   *
   * @module     local_overflow/reviewing
   * @copyright  2022 Justus Dieckmann WWU
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=function(){_prefetch.default.prefetchTemplates(["local_overflow/reject_post_form","local_overflow/review_buttons"]),_prefetch.default.prefetchStrings("local_overflow",["post_was_approved","jump_to_next_post_needing_review","there_are_no_posts_needing_review","post_was_rejected"]);document.getElementById("overflow-posts").onclick=async e=>{const action=e.target.getAttribute("data-overflow-action");if(!action)return;const post=e.target.closest("*[data-overflow-postid]"),reviewRow=e.target.closest(".reviewrow"),postID=post.getAttribute("data-overflow-postid");if("approve"===action){reviewRow.innerHTML=".";const nextPostURL=await _ajax.default.call([{methodname:"local_overflow_review_approve_post",args:{postid:postID}}])[0];let message=await(0,_str.get_string)("post_was_approved","local_overflow")+" ";message+=nextPostURL?'<a href="'.concat(nextPostURL,'">')+await(0,_str.get_string)("jump_to_next_post_needing_review","local_overflow")+"</a>":await(0,_str.get_string)("there_are_no_posts_needing_review","local_overflow"),reviewRow.innerHTML=message,post.classList.remove("pendingreview")}else if("reject"===action)reviewRow.innerHTML=".",reviewRow.innerHTML=await _templates.default.render("local_overflow/reject_post_form",{});else if("reject-submit"===action){const rejectMessage=post.querySelector("textarea.reject-reason").value.toString().trim();reviewRow.innerHTML=".";const args={postid:postID,reason:rejectMessage||null},nextPostURL=await _ajax.default.call([{methodname:"local_overflow_review_reject_post",args:args}])[0];let message=await(0,_str.get_string)("post_was_rejected","local_overflow")+" ";message+=nextPostURL?'<a href="'.concat(nextPostURL,'">')+await(0,_str.get_string)("jump_to_next_post_needing_review","local_overflow")+"</a>":await(0,_str.get_string)("there_are_no_posts_needing_review","local_overflow"),reviewRow.innerHTML=message}else"reject-cancel"===action&&(reviewRow.innerHTML=".",reviewRow.innerHTML=await _templates.default.render("local_overflow/review_buttons",{}))}},_ajax=_interopRequireDefault(_ajax),_prefetch=_interopRequireDefault(_prefetch),_templates=_interopRequireDefault(_templates)}));

//# sourceMappingURL=reviewing.min.js.map